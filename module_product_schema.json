{
  "module": "Product",
  "description": "Schema database, example response, rules, dan query logic untuk module Product super app",
  "tables": {
    "categories": {
      "columns": {
        "id": "uuid PRIMARY KEY",
        "parent_id": "uuid NULL",
        "name": "string NOT NULL",
        "slug": "string NOT NULL UNIQUE",
        "description": "string NULL",
        "path": "string NULL",
        "level": "integer NULL",
        "metadata": "jsonb NULL",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL"
      },
      "rules": [
        "Slug harus unik",
        "Level & path harus sesuai hierarchy parent-child"
      ],
      "example_response": {
        "id": "cat-001",
        "parent_id": null,
        "name": "Minuman",
        "slug": "minuman",
        "description": "Kategori minuman",
        "path": "minuman",
        "level": 1,
        "metadata": {},
        "created_at": "2025-12-05T08:00:00Z",
        "updated_at": "2025-12-05T08:00:00Z"
      },
      "query_logic": [
        "Ambil semua kategori root: SELECT * FROM categories WHERE parent_id IS NULL;",
        "Ambil semua subkategori: SELECT * FROM categories WHERE parent_id = :category_id;"
      ]
    },

    "attribute_master": {
      "columns": {
        "id": "uuid PRIMARY KEY",
        "name": "string NOT NULL",
        "key": "string NOT NULL UNIQUE",
        "metadata": "jsonb NULL",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL"
      },
      "rules": [
        "Key harus unik",
        "Metadata bisa untuk default value atau constraints"
      ],
      "example_response": {
        "id": "attr-001",
        "name": "Size",
        "key": "size",
        "metadata": {"options": ["S", "M", "L"]},
        "created_at": "2025-12-05T08:00:00Z",
        "updated_at": "2025-12-05T08:00:00Z"
      },
      "query_logic": [
        "Ambil semua attribute master: SELECT * FROM attribute_master;",
        "Ambil attribute master by key: SELECT * FROM attribute_master WHERE key='size';"
      ]
    },

    "attribute_custom": {
      "columns": {
        "id": "uuid PRIMARY KEY",
        "merchant_id": "uuid NOT NULL",
        "name": "string NOT NULL",
        "key": "string NOT NULL",
        "metadata": "jsonb NULL",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL"
      },
      "rules": [
        "Key harus unik per merchant"
      ],
      "example_response": {
        "id": "custattr-001",
        "merchant_id": "m-001",
        "name": "Kadar Gula",
        "key": "sugar_level",
        "metadata": {"options": ["Rendah","Sedang","Tinggi"]},
        "created_at": "2025-12-05T08:00:00Z",
        "updated_at": "2025-12-05T08:00:00Z"
      },
      "query_logic": [
        "Ambil attribute custom merchant: SELECT * FROM attribute_custom WHERE merchant_id=:merchant_id;"
      ]
    },

    "products": {
      "columns": {
        "id": "uuid PRIMARY KEY",
        "merchant_id": "uuid NOT NULL",
        "category_id": "uuid NULL",
        "name": "string NOT NULL",
        "slug": "string NOT NULL UNIQUE",
        "description": "string NULL",
        "type": "enum('food','mart','service') NOT NULL",
        "barcode": "string NULL",
        "sku": "string NULL",
        "base_unit": "string NULL",
        "price": "numeric NULL",
        "has_variant": "boolean NOT NULL DEFAULT false",
        "has_expired": "boolean NOT NULL DEFAULT false",
        "metadata": "jsonb NULL",
        "version": "integer NOT NULL DEFAULT 1",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL",
        "deleted_at": "timestamp NULL"
      },
      "rules": [
        "Jika has_variant=false, price harus diisi",
        "SKU/barcode unik per merchant",
        "Version bertambah setiap update",
        "Metadata harus sesuai tipe produk (food/mart/service)"
      ],
      "example_response": {
        "id": "prod-001",
        "merchant_id": "m-001",
        "category_id": "cat-001",
        "name": "Minyak Goreng 1L",
        "slug": "minyak-goreng-1l",
        "type": "mart",
        "barcode": "1234567890123",
        "sku": "MG-001",
        "base_unit": "pcs",
        "price": 15000,
        "has_variant": false,
        "has_expired": false,
        "metadata": {"brand":"Sehat","weight_grams":1000},
        "created_at": "2025-12-05T08:00:00Z",
        "updated_at": "2025-12-05T08:00:00Z"
      },
      "query_logic": [
        "Ambil semua produk merchant: SELECT * FROM products WHERE merchant_id=:merchant_id AND has_expired=false;",
        "Ambil produk by id: SELECT * FROM products WHERE id=:product_id;"
      ]
    },

    "product_variants": {
      "columns": {
        "id": "uuid PRIMARY KEY",
        "product_id": "uuid NOT NULL",
        "name": "string NOT NULL",
        "sku": "string NULL",
        "barcode": "string NULL",
        "attribute_master_ids": "jsonb NULL",
        "attribute_custom_ids": "jsonb NULL",
        "unit": "string NULL",
        "conversion_id": "uuid NULL",
        "price": "numeric NOT NULL",
        "has_expired": "boolean NOT NULL DEFAULT false",
        "metadata": "jsonb NULL",
        "version": "integer NOT NULL DEFAULT 1",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL",
        "deleted_at": "timestamp NULL"
      },
      "rules": [
        "Kombinasi attribute_master_ids + attribute_custom_ids harus unik per produk",
        "SKU/barcode unik per variant",
        "Unit harus valid di unit_conversion",
        "Price harus > 0",
        "Jika has_expired=true, variant tidak bisa dijual"
      ],
      "example_response": [
        {
          "id": "var-001",
          "product_id": "prod-002",
          "name": "Small",
          "sku": "PZM-S",
          "barcode": "987654321001",
          "attribute_master_ids": ["size-small"],
          "unit": "pcs",
          "price": 50000,
          "has_expired": false,
          "metadata": {"spice_level":"medium"}
        },
        {
          "id": "var-002",
          "product_id": "prod-002",
          "name": "Large",
          "sku": "PZM-L",
          "barcode": "987654321002",
          "attribute_master_ids": ["size-large"],
          "unit": "pcs",
          "price": 90000,
          "has_expired": false,
          "metadata": {"spice_level":"medium"}
        }
      ],
      "query_logic": [
        "Ambil semua variant produk: SELECT * FROM product_variants WHERE product_id=:product_id AND has_expired=false;",
        "Ambil variant by sku/barcode: SELECT * FROM product_variants WHERE sku=:sku OR barcode=:barcode;"
      ]
    },

    "product_extras": {
      "columns": {
        "id": "uuid PRIMARY KEY",
        "product_id": "uuid NOT NULL",
        "name": "string NOT NULL",
        "price": "numeric NOT NULL",
        "required": "boolean NOT NULL DEFAULT false",
        "max_qty": "integer NULL",
        "metadata": "jsonb NULL",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL"
      },
      "rules": [
        "Price extras >= 0",
        "Jika required=true, max_qty >=1"
      ],
      "example_response": [
        {"id":"extra-001","product_id":"prod-002","name":"Extra Cheese","price":10000,"required":false,"max_qty":2},
        {"id":"extra-002","product_id":"prod-002","name":"Olives","price":5000,"required":false,"max_qty":3}
      ],
      "query_logic": [
        "Ambil extras produk: SELECT * FROM product_extras WHERE product_id=:product_id;"
      ]
    },

    "product_bundles": {
      "columns": {
        "id": "uuid PRIMARY KEY",
        "name": "string NOT NULL",
        "metadata": "jsonb NULL",
        "version": "integer NOT NULL DEFAULT 1",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL",
        "deleted_at": "timestamp NULL"
      },
      "rules": [
        "Nama bundle unik",
        "Version bertambah setiap update"
      ],
      "example_response": {
        "id": "bundle-001",
        "name": "Lunch Combo Paket",
        "metadata":{"description":"Paket makan siang lengkap + minuman + layanan delivery"},
        "items":[
          {"product_id":"prod-002","product_type":"food","qty":1,"mandatory":true},
          {"product_id":"prod-001","product_type":"mart","qty":2,"mandatory":true},
          {"product_id":"prod-003","product_type":"service","qty":1,"mandatory":false}
        ]
      },
      "query_logic": [
        "Ambil bundle by id: SELECT * FROM product_bundles WHERE id=:bundle_id;",
        "Ambil items bundle: SELECT * FROM bundle_items WHERE bundle_id=:bundle_id;"
      ]
    },

    "unit_conversions": {
      "columns": {
        "id": "uuid PRIMARY KEY",
        "from_unit": "string NOT NULL",
        "to_unit": "string NOT NULL",
        "multiply_factor": "numeric NOT NULL",
        "metadata": "jsonb NULL",
        "parent_conversion_id": "uuid NULL",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL"
      },
      "rules": [
        "Parent conversion harus valid jika multi-level",
        "Multiply_factor > 0"
      ],
      "example_response": [
        {"id":"conv-001","from_unit":"box","to_unit":"pack","multiply_factor":10,"parent_conversion_id":null},
        {"id":"conv-002","from_unit":"pack","to_unit":"pcs","multiply_factor":5,"parent_conversion_id":"conv-001"}
      ],
      "query_logic": [
        "Ambil konversi unit: SELECT * FROM unit_conversions WHERE from_unit=:unit OR to_unit=:unit;"
      ]
    },

    "product_service_details": {
      "columns": {
        "service_id": "uuid PRIMARY KEY",
        "product_id": "uuid NOT NULL",
        "variant_id": "uuid NULL",
        "duration_minutes": "integer NULL",
        "staff_required": "integer NULL",
        "min_participants": "integer NULL",
        "max_participants": "integer NULL",
        "optional_extras": "jsonb NULL",
        "metadata": "jsonb NULL",
        "created_at": "timestamp NOT NULL",
        "updated_at": "timestamp NOT NULL"
      },
      "rules": [
        "Jika variant_id diisi, durasi & price bisa berbeda per variant",
        "Duration_minutes > 0",
        "Min_participants <= Max_participants",
        "Optional_extras sesuai product_extras"
      ],
      "example_response": {
        "service_id": "serv-001",
        "product_id": "prod-003",
        "variant_id": null,
        "duration_minutes": 120,
        "staff_required": 2,
        "min_participants": 1,
        "max_participants": 2,
        "optional_extras":[{"name":"Detergent Extra","price":20000,"max_qty":1}],
        "metadata":{"notes":"Cleaning service rumah"}
      },
      "query_logic": [
        "Ambil detail service produk: SELECT * FROM product_service_details WHERE product_id=:product_id;"
      ]
    }
  }
}
